<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Terminal PowerShell Real - Gemini IA</title>
<style>
body {
  background-color: #0a0a0a;
  color: #00ff66;
  font-family: monospace;
  margin: 0;
  height: 100vh;
  display: flex;
  flex-direction: column;
}
header {
  background-color: #111;
  padding: 10px;
  text-align: center;
  border-bottom: 1px solid #00ff66;
}
#terminal {
  flex: 1;
  overflow-y: auto;
  padding: 10px;
  background-color: #000;
}
#inputLine {
  display: flex;
  border-top: 1px solid #00ff66;
}
#cmd {
  flex: 1;
  background-color: #000;
  color: #00ff66;
  border: none;
  padding: 8px;
  font-family: monospace;
  font-size: 14px;
}
#cmd:focus { outline: none; }
button {
  background-color: #00ff66;
  color: #000;
  border: none;
  padding: 8px 12px;
  cursor: pointer;
  font-weight: bold;
}
button:hover { background-color: #00cc55; }
#panelIA {
  position: fixed;
  top: 0;
  right: -400px;
  width: 400px;
  height: 100%;
  background-color: #111;
  color: #0f0;
  border-left: 2px solid #00ff66;
  overflow-y: auto;
  transition: right 0.3s;
  padding: 10px;
}
#panelIA.open { right: 0; }
#toggleIA {
  position: fixed;
  top: 10px;
  right: 10px;
  z-index: 999;
}
</style>
</head>
<body>
<header>
  <h2>ðŸ’» Terminal PowerShell Real + Gemini IA</h2>
  <button id="startServer">Iniciar Servidor</button>
  <button id="downloadServer">Baixar server.js</button>
  <button id="toggleIA">ðŸ’¡ IA</button>
</header>

<div id="terminal"></div>

<div id="inputLine">
  <span style="color:#00ff66; padding:8px;">PS ></span>
  <input type="text" id="cmd" placeholder="Digite um comando PowerShell...">
  <button id="sendCmd">Executar</button>
</div>

<div id="panelIA">
  <h3>ðŸ’¡ SugestÃµes da IA Gemini</h3>
  <textarea id="iaPrompt" rows="4" style="width:100%; background:#000; color:#0f0;"></textarea>
  <button id="askIA">Sugerir Comandos</button>
  <pre id="iaOutput"></pre>
</div>

<script>
const SERVER_URL = 'http://127.0.0.1:3001';
const TOKEN = 'um-token-muito-forte-que-so-eu-conheco'; // mesmo do server.js

const terminal = document.getElementById('terminal');
const cmdInput = document.getElementById('cmd');
const sendBtn = document.getElementById('sendCmd');
const startBtn = document.getElementById('startServer');
const downloadBtn = document.getElementById('downloadServer');
const toggleIA = document.getElementById('toggleIA');
const panelIA = document.getElementById('panelIA');
const askIA = document.getElementById('askIA');
const iaPrompt = document.getElementById('iaPrompt');
const iaOutput = document.getElementById('iaOutput');

function printToTerminal(text, isError=false) {
  const span = document.createElement('pre');
  span.textContent = text;
  span.style.color = isError ? '#ff5555' : '#00ff66';
  terminal.appendChild(span);
  terminal.scrollTop = terminal.scrollHeight;
}

async function execCommand() {
  const command = cmdInput.value.trim();
  if (!command) return;
  printToTerminal(`> ${command}`);
  cmdInput.value = '';
  try {
    const res = await fetch(`${SERVER_URL}/exec`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json', 'Authorization': 'Bearer ' + TOKEN },
      body: JSON.stringify({ command })
    });
    const data = await res.json();
    if (data.stdout) printToTerminal(data.stdout);
    if (data.stderr) printToTerminal(data.stderr, true);
  } catch (err) {
    printToTerminal('Erro de conexÃ£o com o servidor: ' + err, true);
  }
}

sendBtn.onclick = execCommand;
cmdInput.addEventListener('keypress', e => {
  if (e.key === 'Enter') execCommand();
});

toggleIA.onclick = () => {
  panelIA.classList.toggle('open');
};

askIA.onclick = async () => {
  const prompt = iaPrompt.value.trim();
  if (!prompt) return;
  iaOutput.textContent = 'Consultando IA...';
  const res = await fetch(`${SERVER_URL}/suggest`, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json', 'Authorization': 'Bearer ' + TOKEN },
    body: JSON.stringify({ prompt })
  });
  const data = await res.json();
  iaOutput.textContent = data.raw || JSON.stringify(data, null, 2);
};

startBtn.onclick = async () => {
  try {
    await fetch(`${SERVER_URL}/health`);
    alert('Servidor jÃ¡ estÃ¡ online!');
  } catch {
    printToTerminal('âš™ï¸ Abra manualmente o PowerShell e execute: node server.js', true);
  }
};

downloadBtn.onclick = () => {
  const blob = new Blob([`<?server.js cÃ³digo aqui?>`], { type: 'text/plain' });
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = 'server.js';
  a.click();
};
</script>
</body>
</html>
